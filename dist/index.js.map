{"version":3,"file":"index.js","sources":["../node_modules/flat/node_modules/is-buffer/index.js","../node_modules/flat/index.js","../src/form.js","../src/index.js"],"sourcesContent":["/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n\nmodule.exports = function isBuffer (obj) {\n  return obj != null && obj.constructor != null &&\n    typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n","var isBuffer = require('is-buffer')\n\nmodule.exports = flatten\nflatten.flatten = flatten\nflatten.unflatten = unflatten\n\nfunction keyIdentity (key) {\n  return key\n}\n\nfunction flatten (target, opts) {\n  opts = opts || {}\n\n  const delimiter = opts.delimiter || '.'\n  const maxDepth = opts.maxDepth\n  const transformKey = opts.transformKey || keyIdentity\n  const output = {}\n\n  function step (object, prev, currentDepth) {\n    currentDepth = currentDepth || 1\n    Object.keys(object).forEach(function (key) {\n      const value = object[key]\n      const isarray = opts.safe && Array.isArray(value)\n      const type = Object.prototype.toString.call(value)\n      const isbuffer = isBuffer(value)\n      const isobject = (\n        type === '[object Object]' ||\n        type === '[object Array]'\n      )\n\n      const newKey = prev\n        ? prev + delimiter + transformKey(key)\n        : transformKey(key)\n\n      if (!isarray && !isbuffer && isobject && Object.keys(value).length &&\n        (!opts.maxDepth || currentDepth < maxDepth)) {\n        return step(value, newKey, currentDepth + 1)\n      }\n\n      output[newKey] = value\n    })\n  }\n\n  step(target)\n\n  return output\n}\n\nfunction unflatten (target, opts) {\n  opts = opts || {}\n\n  const delimiter = opts.delimiter || '.'\n  const overwrite = opts.overwrite || false\n  const transformKey = opts.transformKey || keyIdentity\n  const result = {}\n\n  const isbuffer = isBuffer(target)\n  if (isbuffer || Object.prototype.toString.call(target) !== '[object Object]') {\n    return target\n  }\n\n  // safely ensure that the key is\n  // an integer.\n  function getkey (key) {\n    const parsedKey = Number(key)\n\n    return (\n      isNaN(parsedKey) ||\n      key.indexOf('.') !== -1 ||\n      opts.object\n    ) ? key\n      : parsedKey\n  }\n\n  function addKeys (keyPrefix, recipient, target) {\n    return Object.keys(target).reduce(function (result, key) {\n      result[keyPrefix + delimiter + key] = target[key]\n\n      return result\n    }, recipient)\n  }\n\n  function isEmpty (val) {\n    const type = Object.prototype.toString.call(val)\n    const isArray = type === '[object Array]'\n    const isObject = type === '[object Object]'\n\n    if (!val) {\n      return true\n    } else if (isArray) {\n      return !val.length\n    } else if (isObject) {\n      return !Object.keys(val).length\n    }\n  }\n\n  target = Object.keys(target).reduce((result, key) => {\n    const type = Object.prototype.toString.call(target[key])\n    const isObject = (type === '[object Object]' || type === '[object Array]')\n    if (!isObject || isEmpty(target[key])) {\n      result[key] = target[key]\n      return result\n    } else {\n      return addKeys(\n        key,\n        result,\n        flatten(target[key], opts)\n      )\n    }\n  }, {})\n\n  Object.keys(target).forEach(function (key) {\n    const split = key.split(delimiter).map(transformKey)\n    let key1 = getkey(split.shift())\n    let key2 = getkey(split[0])\n    let recipient = result\n\n    while (key2 !== undefined) {\n      const type = Object.prototype.toString.call(recipient[key1])\n      const isobject = (\n        type === '[object Object]' ||\n        type === '[object Array]'\n      )\n\n      // do not write over falsey, non-undefined values if overwrite is false\n      if (!overwrite && !isobject && typeof recipient[key1] !== 'undefined') {\n        return\n      }\n\n      if ((overwrite && !isobject) || (!overwrite && recipient[key1] == null)) {\n        recipient[key1] = (\n          typeof key2 === 'number' &&\n          !opts.object ? [] : {}\n        )\n      }\n\n      recipient = recipient[key1]\n      if (split.length > 0) {\n        key1 = getkey(split.shift())\n        key2 = getkey(split[0])\n      }\n    }\n\n    // unflatten again for 'messy objects'\n    recipient[key1] = unflatten(target[key], opts)\n  })\n\n  return result\n}\n","import { Form } from 'antd'\nimport set from 'lodash/set'\nimport get from 'lodash/get'\nimport forEach from 'lodash/forEach'\n\nexport default Form.create({\n  mapPropsToFields({ formValues, schema }) {\n    const fields = {}\n    forEach(schema.fields, ({ field }) => {\n      const value = get(formValues, field)\n      set(fields, field, Form.createFormField({ value }))\n    })\n    return fields\n  },\n  onValuesChange(props, values) {\n    console.log('props :', props, values)\n    props.onChange && props.onChange(values)\n  },\n})\n","import React from 'react'\nimport set from 'lodash/set'\nimport forEach from 'lodash/forEach'\nimport isEmpty from 'lodash/isEmpty'\nimport get from 'lodash/get'\nimport flat from 'flat'\nimport formCreator from './form'\n\nexport const Form = schema => {\n  if (!schema) throw Error('must provide schema')\n  if (isEmpty(schema.fields)) throw Error('fields cannot be empty!')\n  const formValues = {}\n  forEach(schema.fields, ({ field, decorator }) => {\n    const initialValue = get(decorator, 'initialValue')\n    if (typeof initialValue !== 'undefined')\n      set(formValues, field, initialValue)\n  })\n  return WrapperdComponent => {\n    const FormMocker = formCreator(WrapperdComponent)\n    class Nimama extends React.Component {\n      constructor(props) {\n        super(props)\n        this.state = {\n          formValues,\n        }\n      }\n      // resetFields = (form, depField, depValue) => {\n      //   forEach(settings, ({ dep, field, defaultValue = null }) => {\n      //     if (dep && dep.field === depField && dep.value !== depValue) {\n      //       set(form, field, defaultValue)\n      //       this.resetFields(form, field, defaultValue)\n      //     }\n      //   })\n      // }\n      onChange = changedValues => {\n        const flattened = flat(changedValues)\n        const formValues = this.state.formValues\n        forEach(flattened, (value, key) => {\n          set(formValues, key, value)\n        })\n        console.log('new values', formValues)\n        // this.resetFields(form, field, value)\n        this.setState({ formValues })\n      }\n      render() {\n        return (\n          <FormMocker\n            {...this.state}\n            schema={schema}\n            {...this.props}\n            onChange={this.onChange}\n          />\n        )\n      }\n    }\n    return Nimama\n  }\n}\n"],"names":["isEmpty","Form","create","formValues","schema","fields","field","value","get","createFormField","props","values","log","onChange","Error","decorator","initialValue","set","FormMocker","formCreator","WrapperdComponent","Nimama","flattened","flat","changedValues","state","key","setState","React","Component"],"mappings":"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"}